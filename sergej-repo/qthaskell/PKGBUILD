pkgname=qthaskell
pkgver=1.1.2.1
pkgrel=1
pkgdesc="Haskell QT binding"
url="http://qthaskell.berlios.de"
license=('custom')
arch=('i686' 'x86_64')
makedepends=('ghc' 'haskell-cabal' 'haskell-opengl')
depends=('ghc' 'qt')
options=('strip' '!docs')
source=(http://download.berlios.de/qthaskell/qtHaskell-$pkgver.tar.bz2)
install=qthaskell.install
md5sums=('44dc907f284d9fb7e1c3481d2e94fc74')

build() {
    cd $startdir/src/qtHaskell-1.1.2

    find -name '*.pro' -exec sed -i 's|/usr/local|/usr|' {} \;

    qmake -recursive
    make || return 1
    make INSTALL_ROOT=$pkgdir install || return 1

    runhaskell Setup configure --ghc --prefix=/usr || return 1
    runhaskell Setup build || return 1
    runhaskell Setup register --gen-script || return 1
    runhaskell Setup unregister --gen-script || return 1
    runhaskell Setup copy --destdir=$startdir/pkg || return 1

    install -D -m744 register.sh   $startdir/pkg/usr/share/haskell/$pkgname/register.sh
    install    -m744 unregister.sh $startdir/pkg/usr/share/haskell/$pkgname/unregister.sh

    install -D -m644 LICENSE $startdir/pkg/usr/share/licenses/$pkgname/LICENSE || return 1
}
