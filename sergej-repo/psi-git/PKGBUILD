# Contributor: slubman <slubman.dndd@slubman.info>

pkgname=psi-git
pkgver=1198
pkgrel=1
pkgdesc="A jabber client SVN version"
arch=('i686' 'x86_64')
makedepends=('subversion')
depends=('qt' 'aspell' 'libxss' 'speex' 'ortp' 'glib2')
source=(psi-icon-actions-shortcuts.patch whiteboard.patch)
conflicts=('psi')
provides=('psi')
license=('custom')
url="http://psi-im.org/"

_gitroot="git://git.psi-im.org/psi.git"
_gitname="psi"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

#  rm -rf "$srcdir/$_gitname-build"
#  cp -r "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  # building
  msg "Starting build"

#  patch -p1 <../psi-icon-actions-shortcuts.patch
#  patch -p1 <../whiteboard.patch

  ./configure-jingle --prefix=/usr || return 1
  make || return 1
  make INSTALL_ROOT=$startdir/pkg install || return 1

  # Copy Psi license
  install -D COPYING $startdir/pkg/usr/share/licenses/$pkgname/COPYING

  # Remove all those stupdid svn related files installed
  find $startdir/pkg -type d -name '.svn' | xargs rm -rf
}
