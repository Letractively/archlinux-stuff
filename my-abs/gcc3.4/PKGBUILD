pkgname=gcc3.4
pkgver=3.4.6
pkgrel=1
pkgdesc="The GNU Compiler Collection - Version 3.4"
url="http://gcc.gnu.org"
depends=('glibc' 'binutils')
source=(ftp://gcc.gnu.org/pub/gcc/releases/gcc-${pkgver}/gcc-{core,g++}-${pkgver}.tar.bz2)
md5sums=('5324ace5145b12afd9ca867af7ec084d' 'ef81fd74bc9fd964120af47243a1360f')

build() {
  mkdir -p $startdir/src/gcc-build
  cd $startdir/src/gcc-build
  ../gcc-${pkgver}/configure --host="${CHOST}" --build="${CHOST}" \
     --prefix=/opt/gcc3.4 --enable-shared --enable-languages=c,c++ \
     --enable-threads=posix --enable-__cxa_atexit
  make bootstrap || return 1
  make DESTDIR=$startdir/pkg install || return 1

  # Remove libstdc++ provided by gcc4 package
  rm -f $startdir/pkg/opt/gcc3.4/lib/libstdc++.so*

  # Create symlinks
  mkdir -p $startdir/pkg/usr/bin
  ln -sf /opt/gcc3.4/bin/g++ $startdir/pkg/usr/bin/g++3.4
  ln -sf /opt/gcc3.4/bin/gcc $startdir/pkg/usr/bin/gcc3.4

  find $startdir/pkg -name '*.la' -exec rm {} \;
}
