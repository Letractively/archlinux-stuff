# Contributor: Sergej Pupykin <ps@lx-ltd.ru>
arch=(i686 x86_64)
pkgname=nvidia-kernel
pkgver=1.0.9629
_pkgver=1.0-9629
pkgrel=1
pkgdesc="nVidia kernel driver for XFree86/X.Org"
url="http://www.nvidia.com"
depends=('bash' 'gcc' 'binutils' 'glibc' 'make')
install=nvidia.install

case $CARCH in
    x86_64)
	_pkgbinary=NVIDIA-Linux-x86_64-$_pkgver
	source=(http://download.nvidia.com/XFree86/Linux-x86_64/$_pkgver/$_pkgbinary-pkg0.run \
		nvidia.rc)
	;;
    i686)
	_pkgbinary=NVIDIA-Linux-x86-$_pkgver
	source=(http://download.nvidia.com/XFree86/Linux-x86/$_pkgver/$_pkgbinary-pkg0.run \
		nvidia.rc)
	;;
    *)
	exit 1
	;;
esac

build()
{
  cd $startdir/src/
  chmod +x $_pkgbinary-pkg0.run
  rm -rf ./$_pkgbinary-pkg0
  ./$_pkgbinary-pkg0.run --extract-only
  cd $_pkgbinary-pkg0
  
  install -D -m 755 $startdir/src/nvidia.rc $startdir/pkg/etc/rc.d/nvidia

  cd usr/src/nv
  make
  make -f Makefile.kbuild module
  install -D -m0644 nvidia.ko $startdir/pkg/lib/modules/`uname -r`/misc/nvidia.ko
}
